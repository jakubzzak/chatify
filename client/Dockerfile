FROM node:20.2.0-alpine3.18

ARG NODE_ENV
ARG PORT
ARG HOST
ARG NEXT_PUBLIC_BACKEND_URL
ARG NEXT_PUBLIC_FIREBASE_CONFIG

WORKDIR /app
COPY . .

RUN npm install --production=false

ENV NODE_ENV=${NODE_ENV}
ENV PORT=${PORT}
ENV HOST=${HOST}
ENV NEXT_PUBLIC_BACKEND_URL=${NEXT_PUBLIC_BACKEND_URL}
ENV NEXT_PUBLIC_FIREBASE_CONFIG=${NEXT_PUBLIC_FIREBASE_CONFIG}

RUN npm run build

RUN npm ci sharp

CMD ["npm", "run", "start:prod"]